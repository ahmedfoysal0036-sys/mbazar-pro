import streamlit as st
import random
import string
import os
from cryptography.fernet import Fernet

# --- CONFIGURATION ---
KEY = b'vU0_uB5eY3W3X6_zN9kL8mP1qR4tV7wY9zB2xK5mN8o='
cipher = Fernet(KEY)
FILE_NAME = "Planetary_Davistation.txt"

# --- UI ENHANCEMENT (Premium Orange Theme) ---
st.set_page_config(page_title="Security V2.1 Cloud Base", layout="wide")

st.markdown("""
    <style>
    .stApp { background-color: #FFF9F2; }
    .stTabs [data-baseweb="tab-list"] { gap: 20px; }
    .stTabs [data-baseweb="tab"] {
        height: 50px;
        white-space: pre-wrap;
        background-color: #FFE4B5;
        border-radius: 10px 10px 0px 0px;
        color: #D35400;
        padding: 10px 20px;
    }
    .stTabs [aria-selected="true"] {
        background-color: #FF8C00 !important;
        color: white !important;
    }
    .password-display {
        background-color: #333;
        color: #00FF00;
        padding: 15px;
        border-radius: 10px;
        font-family: 'Courier New', monospace;
        text-align: center;
        font-size: 24px;
        border: 2px solid #FF8C00;
    }
    </style>
    """, unsafe_allow_html=True)

# --- INTELLIGENCE MODULE: PASSWORD GENERATOR ---
def generate_strong_password(length=16):
    chars = string.ascii_letters + string.digits + "!@#$%^&*"
    return ''.join(random.choice(chars) for _ in range(length))

# --- MAIN APPLICATION LOGIC ---
if 'auth' not in st.session_state: st.session_state.auth = False

if not st.session_state.auth:
    st.title("üîê Ultimate Gallery: Security V2.1")
    user = st.text_input("Master Identity")
    code = st.text_input("Access Code", type="password")
    if st.button("BYPASS LOCK"):
        if user == "faisal" and code == "1234":
            st.session_state.auth = True
            st.rerun()
else:
    st.sidebar.title("üß° System Core")
    hero = st.sidebar.text_input("Security Challenge: Favourite Hero?", type="password")

    if hero.lower() == "tony":
        tab1, tab2, tab3 = st.tabs(["üìÇ Vault View", "üß† Intelligence Lab", "üåê Cloud Control"])

        with tab1:
            st.subheader("Secured Data Nodes")
            if os.path.exists(FILE_NAME):
                with open(FILE_NAME, "rb") as f:
                    for i, line in enumerate(f):
                        data = cipher.decrypt(line.strip()).decode()
                        st.markdown(f'<div style="background: white; border-left: 5px solid #FF8C00; padding: 15px; margin-bottom: 10px; border-radius: 5px;"><b>[{i+1:02d}]</b> {data}</div>', unsafe_allow_html=True)
            else: st.info("Vault is clean.")

        with tab2:
            st.subheader("Auto Password Generator")
            pass_len = st.slider("Select Complexity Level", 8, 32, 16)
            if st.button("Generate Master Key"):
                new_pass = generate_strong_password(pass_len)
                st.markdown(f'<div class="password-display">{new_pass}</div>', unsafe_allow_html=True)
                st.info("You can copy this and add it to your Vault.")

        with tab3:
            st.subheader("Cloud Synchronization (Beta)")
            st.write("Current Status: Local Mode (Planetary_Davistation.txt)")
            st.warning("Firebase Integration is ready for setup.")
            if st.button("Initialize Cloud Bridge"):
                st.write(">>> Creating secure bridge to Firebase...")
                st.success("Bridge Established (Simulation).")

    else: st.sidebar.info("Awaiting 'Tony' protocol verification...")

    if st.sidebar.button("Logout"):
        st.session_state.auth = False
        st.rerun()